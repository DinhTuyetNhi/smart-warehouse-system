<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Smart Warehouse - ƒêƒÉng k√Ω kho</title>

    <!-- Custom fonts for this template-->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
        rel="stylesheet">

    <!-- Custom styles for this template-->
    <link href="css/sb-admin-2.min.css" rel="stylesheet">
    
    <style>
        .register-form {
            max-height: 80vh;
            overflow-y: auto;
        }
        .form-section {
            background: #f8f9fc;
            border-left: 4px solid #4e73df;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        .section-title {
            color: #4e73df;
            font-weight: bold;
            margin-bottom: 15px;
        }
        .username-preview {
            background: #e3f2fd;
            border: 2px dashed #2196f3;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-family: monospace;
            color: #1976d2;
            font-weight: bold;
        }
    </style>
</head>

<body class="bg-gradient-primary">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-xl-10 col-lg-12 col-md-9">
                <div class="card o-hidden border-0 shadow-lg my-5">
                    <div class="card-body p-0">
                        <div class="row">
                            <div class="col-lg-6 d-none d-lg-block">
                                <div class="p-5 d-flex align-items-center justify-content-center h-100 bg-gradient-info">
                                    <div class="text-center text-white">
                                        <i class="fas fa-warehouse fa-5x mb-4"></i>
                                        <h4>Smart Warehouse System</h4>
                                        <p>H·ªá th·ªëng qu·∫£n l√Ω kho th√¥ng minh</p>
                                        <hr class="my-4">
                                        <p class="mb-0">ƒêƒÉng k√Ω ƒë·ªÉ t·∫°o kho v√† qu·∫£n l√Ω h√†ng h√≥a c·ªßa b·∫°n</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="p-5 register-form">
                                    <div class="text-center">
                                        <h1 class="h4 text-gray-900 mb-2">ƒêƒÉng k√Ω kho m·ªõi</h1>
                                        <p class="mb-4 text-muted">T·∫°o t√†i kho·∫£n qu·∫£n l√Ω kho c·ªßa b·∫°n</p>
                                    </div>
                                    
                                    <!-- Alert messages -->
                                    <div id="alert-container"></div>
                                    
                                    <form class="user" id="registerForm">
                                        <!-- Th√¥ng tin kho -->
                                        <div class="form-section">
                                            <div class="section-title">
                                                <i class="fas fa-warehouse mr-2"></i>Th√¥ng tin kho
                                            </div>
                                            
                                            <div class="form-group">
                                                <input type="text" class="form-control form-control-user" 
                                                    id="warehouse_name" name="warehouse_name" required
                                                    placeholder="T√™n kho *">
                                            </div>
                                            
                                            <div class="form-group">
                                                <textarea class="form-control" id="warehouse_address" 
                                                    name="warehouse_address" required rows="3"
                                                    placeholder="ƒê·ªãa ch·ªâ kho *" style="border-radius: 10rem; padding: 0.75rem 1rem;"></textarea>
                                            </div>
                                            
                                            <div class="form-group">
                                                <input type="tel" class="form-control form-control-user" 
                                                    id="warehouse_phone" name="warehouse_phone" required
                                                    placeholder="S·ªë ƒëi·ªán tho·∫°i kho *">
                                            </div>
                                            
                                            <div class="form-group">
                                                <input type="email" class="form-control form-control-user" 
                                                    id="warehouse_email" name="warehouse_email" required
                                                    placeholder="Email kho *">
                                            </div>
                                        </div>
                                        
                                        <!-- Th√¥ng tin qu·∫£n l√Ω -->
                                        <div class="form-section">
                                            <div class="section-title">
                                                <i class="fas fa-user-shield mr-2"></i>Th√¥ng tin qu·∫£n l√Ω (Admin)
                                            </div>
                                            
                                            <div class="form-group">
                                                <input type="text" class="form-control form-control-user" 
                                                    id="admin_name" name="admin_name" required
                                                    placeholder="H·ªç t√™n qu·∫£n l√Ω *">
                                            </div>
                                            
                                            <!-- Hi·ªÉn th·ªã username s·∫Ω ƒë∆∞·ª£c t·∫°o -->
                                            <div class="form-group">
                                                <label class="small text-muted">
                                                    <i class="fas fa-user mr-1"></i>T√™n ƒëƒÉng nh·∫≠p (t·ª± ƒë·ªông t·∫°o):
                                                </label>
                                                <div class="username-preview" id="username-preview">
                                                    <i class="fas fa-magic mr-2"></i>Nh·∫≠p th√¥ng tin ƒë·ªÉ xem username...
                                                </div>
                                                <small class="text-muted">
                                                    Quy t·∫Øc: Ch·ªØ c√°i ƒë·∫ßu h·ªç t√™n + M√£ kho + 3 s·ªë cu·ªëi ID
                                                </small>
                                            </div>
                                            
                                            <div class="form-group">
                                                <input type="password" class="form-control form-control-user"
                                                    id="password" name="password" required
                                                    placeholder="M·∫≠t kh·∫©u *">
                                            </div>
                                            
                                            <div class="form-group">
                                                <input type="password" class="form-control form-control-user"
                                                    id="confirm_password" name="confirm_password" required
                                                    placeholder="X√°c nh·∫≠n m·∫≠t kh·∫©u *">
                                            </div>
                                        </div>
                                        
                                        <!-- Y√™u c·∫ßu m·∫≠t kh·∫©u -->
                                        <div class="alert alert-info">
                                            <small>
                                                <i class="fas fa-info-circle mr-1"></i>
                                                <strong>Y√™u c·∫ßu m·∫≠t kh·∫©u:</strong><br>
                                                ‚Ä¢ T·ªëi thi·ªÉu 8 k√Ω t·ª±<br>
                                                ‚Ä¢ C√≥ √≠t nh·∫•t 1 ch·ªØ hoa, 1 ch·ªØ th∆∞·ªùng<br>
                                                ‚Ä¢ C√≥ √≠t nh·∫•t 1 s·ªë v√† 1 k√Ω t·ª± ƒë·∫∑c bi·ªát
                                            </small>
                                        </div>
                                        
                                        <div class="alert alert-warning">
                                            <small>
                                                <i class="fas fa-exclamation-triangle mr-1"></i>
                                                <strong>L∆∞u √Ω:</strong> T√†i kho·∫£n ƒë∆∞·ª£c t·∫°o s·∫Ω c√≥ quy·ªÅn <strong>Admin</strong> 
                                                ƒë·ªÉ qu·∫£n l√Ω kho n√†y. T√™n ƒëƒÉng nh·∫≠p s·∫Ω ƒë∆∞·ª£c h·ªá th·ªëng t·ª± ƒë·ªông t·∫°o theo quy t·∫Øc.
                                            </small>
                                        </div>
                                        
                                        <button type="submit" class="btn btn-primary btn-user btn-block" id="registerBtn">
                                            <i class="fas fa-user-plus mr-2"></i>
                                            ƒêƒÉng k√Ω
                                        </button>
                                    </form>
                                    
                                    <hr>
                                    <div class="text-center">
                                        <a class="small" href="login.html">ƒê√£ c√≥ t√†i kho·∫£n? ƒêƒÉng nh·∫≠p!</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap core JavaScript-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="js/sb-admin-2.min.js"></script>

    <!-- Register script -->
    <script>
        $(document).ready(function() {
            // C·∫≠p nh·∫≠t preview username khi user nh·∫≠p th√¥ng tin
            $('#warehouse_name, #admin_name').on('input', function() {
                updateUsernamePreview();
            });
            
            $('#registerForm').on('submit', function(e) {
                e.preventDefault();
                
                // L·∫•y d·ªØ li·ªáu t·ª´ form
                const formData = {
                    warehouse_name: $('#warehouse_name').val().trim(),
                    warehouse_address: $('#warehouse_address').val().trim(),
                    warehouse_phone: $('#warehouse_phone').val().trim(),
                    warehouse_email: $('#warehouse_email').val().trim(),
                    admin_name: $('#admin_name').val().trim(),
                    password: $('#password').val(),
                    confirm_password: $('#confirm_password').val()
                };
                
                // Validate ph√≠a client
                if (!validateForm(formData)) {
                    return;
                }
                
                $('#registerBtn').prop('disabled', true).html('<i class="fas fa-spinner fa-spin mr-2"></i>ƒêang ƒëƒÉng k√Ω...');
                
                $.ajax({
                    url: 'auth/register_process.php',
                    type: 'POST',
                    data: formData,
                    dataType: 'json',
                    success: function(response) {
                        if (response.success) {
                            let alertType = response.data.email_sent ? 'success' : 'warning';
                            let emailIcon = response.data.email_sent ? 'üìß' : '‚ö†Ô∏è';
                            
                            showAlert(`
                                ${emailIcon} ${response.message}<br>
                                <strong>Username ƒë∆∞·ª£c t·∫°o:</strong> ${response.data.username}<br>
                                <div class="mt-2 p-2 bg-light border-left border-primary">
                                    <small class="text-muted">
                                        ${response.data.email_sent 
                                            ? '‚úÖ Email x√°c nh·∫≠n ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn: ' + response.data.email 
                                            : '‚ö†Ô∏è C√≥ l·ªói khi g·ª≠i email. Vui l√≤ng li√™n h·ªá support.'}
                                    </small>
                                </div>
                            `, alertType);
                            
                            setTimeout(function() {
                                window.location.href = 'login.html';
                            }, 5000);
                        } else {
                            showAlert(response.message, 'danger');
                        }
                    },
                    error: function(xhr) {
                        const response = xhr.responseJSON || {message: 'C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i!'};
                        showAlert(response.message, 'danger');
                    },
                    complete: function() {
                        $('#registerBtn').prop('disabled', false).html('<i class="fas fa-user-plus mr-2"></i>ƒêƒÉng k√Ω');
                    }
                });
            });
        });
        
        function updateUsernamePreview() {
            const warehouseName = $('#warehouse_name').val().trim();
            const adminName = $('#admin_name').val().trim();
            
            if (warehouseName && adminName) {
                const username = generateUsernamePreview(adminName, warehouseName);
                $('#username-preview').html(`<i class="fas fa-user mr-2"></i>${username}xxx`);
            } else {
                $('#username-preview').html('<i class="fas fa-magic mr-2"></i>Nh·∫≠p th√¥ng tin ƒë·ªÉ xem username...');
            }
        }
        
        function generateUsernamePreview(fullName, warehouseName) {
            // T·∫°o ch·ªØ c√°i ƒë·∫ßu t·ª´ h·ªç t√™n
            const nameInitials = generateNameInitials(fullName);
            
            // T·∫°o m√£ kho t·ª´ t√™n kho
            const warehouseCode = generateWarehouseCode(warehouseName);
            
            return nameInitials + warehouseCode;
        }
        
        function generateNameInitials(fullName) {
            // Lo·∫°i b·ªè d·∫•u v√† chuy·ªÉn th√†nh ch·ªØ th∆∞·ªùng
            const normalized = removeVietnameseTones(fullName).toLowerCase();
            
            // T√°ch th√†nh c√°c t·ª´
            const words = normalized.split(/\s+/).filter(word => word.length > 0);
            
            if (words.length === 0) return '';
            
            // L·∫•y ch·ªØ c√°i ƒë·∫ßu c·ªßa t·ª´ng t·ª´
            let initials = '';
            for (let i = 0; i < words.length - 1; i++) { // L·∫•y ch·ªØ c√°i ƒë·∫ßu c·ªßa h·ªç, t√™n ƒë·ªám
                initials += words[i].charAt(0);
            }
            
            // Th√™m t√™n ƒë·∫ßy ƒë·ªß kh√¥ng kho·∫£ng tr·∫Øng
            if (words.length > 0) {
                initials += words[words.length - 1]; // T√™n cu·ªëi
            }
            
            return initials;
        }
        
        function generateWarehouseCode(warehouseName) {
            // Lo·∫°i b·ªè d·∫•u v√† kho·∫£ng tr·∫Øng
            return removeVietnameseTones(warehouseName)
                .toLowerCase()
                .replace(/\s+/g, '')
                .replace(/[^a-z0-9]/g, '');
        }
        
        function removeVietnameseTones(str) {
            const accents = {
                '√†|√°|·∫°|·∫£|√£|√¢|·∫ß|·∫•|·∫≠|·∫©|·∫´|ƒÉ|·∫±|·∫Ø|·∫∑|·∫≥|·∫µ': 'a',
                '√®|√©|·∫π|·∫ª|·∫Ω|√™|·ªÅ|·∫ø|·ªá|·ªÉ|·ªÖ': 'e',
                '√¨|√≠|·ªã|·ªâ|ƒ©': 'i',
                '√≤|√≥|·ªç|·ªè|√µ|√¥|·ªì|·ªë|·ªô|·ªï|·ªó|∆°|·ªù|·ªõ|·ª£|·ªü|·ª°': 'o',
                '√π|√∫|·ª•|·ªß|≈©|∆∞|·ª´|·ª©|·ª±|·ª≠|·ªØ': 'u',
                '·ª≥|√Ω|·ªµ|·ª∑|·ªπ': 'y',
                'ƒë': 'd',
                '√Ä|√Å|·∫†|·∫¢|√É|√Ç|·∫¶|·∫§|·∫¨|·∫®|·∫™|ƒÇ|·∫∞|·∫Æ|·∫∂|·∫≤|·∫¥': 'A',
                '√à|√â|·∫∏|·∫∫|·∫º|√ä|·ªÄ|·∫æ|·ªÜ|·ªÇ|·ªÑ': 'E',
                '√å|√ç|·ªä|·ªà|ƒ®': 'I',
                '√í|√ì|·ªå|·ªé|√ï|√î|·ªí|·ªê|·ªò|·ªî|·ªñ|∆†|·ªú|·ªö|·ª¢|·ªû|·ª†': 'O',
                '√ô|√ö|·ª§|·ª¶|≈®|∆Ø|·ª™|·ª®|·ª∞|·ª¨|·ªÆ': 'U',
                '·ª≤|√ù|·ª¥|·ª∂|·ª∏': 'Y',
                'ƒê': 'D'
            };
            
            for (let pattern in accents) {
                str = str.replace(new RegExp(pattern, 'g'), accents[pattern]);
            }
            
            return str;
        }
        
        function validateForm(data) {
            // Ki·ªÉm tra c√°c tr∆∞·ªùng b·∫Øt bu·ªôc (lo·∫°i b·ªè username)
            const requiredFields = ['warehouse_name', 'warehouse_address', 'warehouse_phone', 'warehouse_email', 'admin_name', 'password'];
            for (let field of requiredFields) {
                if (!data[field]) {
                    showAlert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin b·∫Øt bu·ªôc!', 'warning');
                    return false;
                }
            }
            
            // Ki·ªÉm tra email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(data.warehouse_email)) {
                showAlert('Email kh√¥ng h·ª£p l·ªá!', 'warning');
                return false;
            }
            
            // Ki·ªÉm tra s·ªë ƒëi·ªán tho·∫°i
            const phoneRegex = /^[0-9]{10,11}$/;
            if (!phoneRegex.test(data.warehouse_phone)) {
                showAlert('S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá!', 'warning');
                return false;
            }
            
            // Ki·ªÉm tra m·∫≠t kh·∫©u
            if (data.password !== data.confirm_password) {
                showAlert('M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp!', 'warning');
                return false;
            }
            
            if (!isStrongPassword(data.password)) {
                showAlert('M·∫≠t kh·∫©u kh√¥ng ƒë·ªß m·∫°nh! Vui l√≤ng ki·ªÉm tra y√™u c·∫ßu.', 'warning');
                return false;
            }
            
            return true;
        }
        
        function isStrongPassword(password) {
            if (password.length < 8) return false;
            if (!/[a-z]/.test(password)) return false;
            if (!/[A-Z]/.test(password)) return false;
            if (!/[0-9]/.test(password)) return false;
            if (!/[^a-zA-Z0-9]/.test(password)) return false;
            return true;
        }
        
        function showAlert(message, type) {
            const alertHtml = `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                    ${message}
                    <button type="button" class="close" data-dismiss="alert">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            `;
            $('#alert-container').html(alertHtml);
            
            // Scroll to top ƒë·ªÉ hi·ªÉn th·ªã alert
            $('.register-form').scrollTop(0);
        }
    </script>
</body>
</html>